## Cookie

### HTTP 쿠키
- 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각.
- 동일한 서버에 재요청 시 저장된 데이터 함께 전송
- 상태가 없는(stateless) HTTP 프로토콜에서 상태 정보를 기억하기 위한 수단
- 목적
  - 세션 관리: 서버에 저장해야 할 로그인, 장바구니, 게임 스코어 등의 정보 관리
  - 개인화: 사용자 선호, 테마 등 세팅
  - 트래킹: 사용자 행동을 기록하고 분석

### Set-Cookie와 옵션
`Set-Cookie: <cookie-name>=<cookie-value>`

클라이언트에 쿠키를 저장하라고 전달 -> 서버로 전송되는 모든 요청에 Cookie 헤더를 사용하여 이전에 저장했던 모든 쿠키 회신

**Domain**
- 어떤 도메인에 요청을 보낼 때 쿠키를 함께 사용할 것인지 명시
- 하나의 도메인만 가능
- 생략 시 정확한 도메인에서만 쿠키 사용, 서브 도메인 공유 X
- '/' 시 모든 서브 도메인 포함

**Expires**
- 쿠키가 언제까지 유효한지 명시
- HTTP-date timestamp 형식을 따라야 한다.
- 생략 시 세션 만료에 쿠키도 함께 만료
- 쿠키의 만료일자는 클라이언트와 관련, 서버와는 관련 X

**HttpOnly**
- Document.cookie로 JS를 통해 쿠키에 접근하는 것을 막음
- 여전히 XMLHttpRequest.send() 혹은 fetch() 호출 시 함께 전송, XSS 공격을 완화하는데 도움

**Max-Age**
- 쿠키의 유효기간 명시, 단위: 초
- Expire와 동일한 역할, 함께 쓰면 Max-Age가 적용

**Partitioned**
- 최근 추가된 기능, 쿠키가 분리된 저장소에 저장되어야 함을 명시
- 쿠키를 통한 개인정보 침해 우려?

**Path**
- 사이트의 특정한 경로에만 쿠키를 적용하고 싶을 때
- 하위 경로에도 적용

**SameSite**
- 다른 사이트와 통신 시에도 적용할지 설정
- CSRF 공격에 대한 어느 정도 방어
- value
  - Strict: 같은 주소의 요청에만 쿠키 전송
  - Lax: 안전한 HTTP 메소드 정도만 예외, Strict와 동일하게 처리
    - 외부 사이트에서 링크를 타고 들어오는 경우가 여기에 해당하는 예외
    - 생략하는 경우 Lax가 기본값
  - None: cross-site와 same-site 구분 않고 무조건 쿠키 전송
    - Secure 속성이 반드시 같이 있어야 함
    - https를 통하지 않은 SameSite=None의 쿠키는 해커에 의해 값이 탈취될 수 있음

**Secure**
- https: 스키마를 통한 통신 요청에만 쿠키를 함께 전송
  - 단, localhost 도메인은 예외


***참고 자료***
- https://jake-seo-dev.tistory.com/377
- https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie
